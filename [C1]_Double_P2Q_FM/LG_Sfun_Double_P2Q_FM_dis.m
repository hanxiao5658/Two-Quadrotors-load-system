function [sys,x0,str,ts] = LG_Sfun_Double_P2Q_FM_dis(t,x,u,flag,xp0,yp0,zp0,a10,b10,a20,b20) 
%%
 switch flag
    case 0
    [sys,x0,str,ts]=mdlInitializeSizes(xp0,yp0,zp0,a10,b10,a20,b20); 
    case 1
    sys=mdlDerivatives(t,x,u); 
    case 3
    sys=mdlOutputs(t,x,u); 
    case { 2, 4, 9 }
    sys = []; 
    otherwise 
    error(['Unhandled flag = ',num2str(flag)]); 
end 
function [sys,x0,str,ts]=mdlInitializeSizes(xp0,yp0,zp0,a10,b10,a20,b20)
%% 
sizes = simsizes; 
sizes.NumContStates = 26; 
sizes.NumDiscStates = 0; 
sizes.NumOutputs = 26; 
sizes.NumInputs = 11; 
sizes.DirFeedthrough = 0; 
sizes.NumSampleTimes = 1; 
sys = simsizes(sizes);

% x0 = [xp0;0;yp0;0;zp0;0; ...
%     deg2rad(a10);deg2rad(0);deg2rad(b10);deg2rad(0);...
%     0.1526;0;0;0;deg2rad(0);0; ...
%     deg2rad(a20);deg2rad(0);deg2rad(b20);deg2rad(0);...
%     -0.1526;0;0;0;deg2rad(0);0;];  

x0 = [xp0;0;yp0;0;zp0;0; ...
    deg2rad(a10);deg2rad(0);deg2rad(b10);deg2rad(0); ...
    0;0;0.1526;0;deg2rad(0);0; ...
    deg2rad(a20);deg2rad(0);deg2rad(b20);deg2rad(0); ...
    0;0;-0.1526;0;deg2rad(0);0;];

% x0 = [0;0;0;        xP0;yP0;zP0;     ...
%     deg2rad(0);0;  deg2rad(a10);deg2rad(b10);...
%     0;-0.0268;0;        deg2rad(0);deg2rad(0);deg2rad(0);...
%     deg2rad(0);0;  deg2rad(a20);deg2rad(b20);...
%     0;0.0268;0;        deg2rad(0);deg2rad(0);deg2rad(0)];  

% x0= [dx0,dy0,dz0;  x0;y0;z0;...
%      da1;db1;  a1;b1;  ...
%      dphi1;dtheta1;dpsi1;phi10;theta10;psi10;...
%      da2;db2;  a2;b2;  
%      dphi2;dtheta2;dpsi2;phi20;theta20;psi20]

%Air Force Parameters:
str = []; 
ts = [0 0]; 
function sys=mdlDerivatives(t,x,u) 
%% Model states and controllors:
xp = x(1); dxp = x(2);
yp = x(3); dyp = x(4);
zp = x(5); dzp = x(6);
alpha1 = x(7); dalpha1 = x(8);
beta1 = x(9); dbeta1 = x(10);
phi1 = x(11); dphi1 = x(12);
theta1 = x(13); dtheta1 = x(14);
psi1 = x(15); dpsi1 = x(16);

alpha2 = x(17); dalpha2 = x(18);
beta2 = x(19); dbeta2 = x(20);
phi2 = x(21); dphi2 = x(22);
theta2 = x(23); dtheta2 = x(24);
psi2 = x(25); dpsi2 = x(26);

Fz1=u(1);Mx1=u(2);My1=u(3);Mz1=u(4);
Fz2=u(5);Mx2=u(6);My2=u(7);Mz2=u(8);
Fxp = u(9);
Fyp = u(10);
Fzp = u(11);
% Parameters:
% Quadcopter Parameters:
mQ1 = 0.55 - 0.55*0.0;
mQ2 = 0.55 + 0.55*0.0;
g = 9.8;

Ix1=0.0023 + 0.0023*0.0;
Iy1=0.0028;
Iz1=0.0046;
Ix2=0.0023;
Iy2=0.0028;
Iz2=0.0046;

% Payload parameters:
mP = 0.2;
Lr = 1 ;
%% Generalized Force
M = [mP+mQ1+mQ2,0,0,(-1).*Lr.*mQ1.*cos(beta1).*sin(alpha1),(-1).*Lr.* ...
  mQ1.*cos(alpha1).*sin(beta1),0,0,0,(-1).*Lr.*mQ2.*cos(beta2).*sin( ...
  alpha2),(-1).*Lr.*mQ2.*cos(alpha2).*sin(beta2),0,0,0;0,mP+mQ1+mQ2, ...
  0,Lr.*mQ1.*cos(alpha1).*cos(beta1),(-1).*Lr.*mQ1.*sin(alpha1).* ...
  sin(beta1),0,0,0,Lr.*mQ2.*cos(alpha2).*cos(beta2),(-1).*Lr.*mQ2.* ...
  sin(alpha2).*sin(beta2),0,0,0;0,0,mP+mQ1+mQ2,0,Lr.*mQ1.*cos(beta1) ...
  ,0,0,0,0,Lr.*mQ2.*cos(beta2),0,0,0;(-1).*Lr.*mQ1.*cos(beta1).*sin( ...
  alpha1),Lr.*mQ1.*cos(alpha1).*cos(beta1),0,Lr.^2.*mQ1.*cos(beta1) ...
  .^2,0,0,0,0,0,0,0,0,0;(-1).*Lr.*mQ1.*cos(alpha1).*sin(beta1),(-1) ...
  .*Lr.*mQ1.*sin(alpha1).*sin(beta1),Lr.*mQ1.*cos(beta1),0,Lr.^2.* ...
  mQ1,0,0,0,0,0,0,0,0;0,0,0,0,0,Ix1,0,(-1).*Ix1.*sin(theta1),0,0,0, ...
  0,0;0,0,0,0,0,0,Iy1.*cos(phi1).^2+Iz1.*sin(phi1).^2,(Iy1+(-1).* ...
  Iz1).*cos(phi1).*cos(theta1).*sin(phi1),0,0,0,0,0;0,0,0,0,0,(-1).* ...
  Ix1.*sin(theta1),(Iy1+(-1).*Iz1).*cos(phi1).*cos(theta1).*sin( ...
  phi1),cos(theta1).^2.*(Iz1.*cos(phi1).^2+Iy1.*sin(phi1).^2)+Ix1.* ...
  sin(theta1).^2,0,0,0,0,0;(-1).*Lr.*mQ2.*cos(beta2).*sin(alpha2), ...
  Lr.*mQ2.*cos(alpha2).*cos(beta2),0,0,0,0,0,0,Lr.^2.*mQ2.*cos( ...
  beta2).^2,0,0,0,0;(-1).*Lr.*mQ2.*cos(alpha2).*sin(beta2),(-1).* ...
  Lr.*mQ2.*sin(alpha2).*sin(beta2),Lr.*mQ2.*cos(beta2),0,0,0,0,0,0, ...
  Lr.^2.*mQ2,0,0,0;0,0,0,0,0,0,0,0,0,0,Ix2,0,(-1).*Ix2.*sin(theta2); ...
  0,0,0,0,0,0,0,0,0,0,0,Iy2.*cos(phi2).^2+Iz2.*sin(phi2).^2,(Iy2+( ...
  -1).*Iz2).*cos(phi2).*cos(theta2).*sin(phi2);0,0,0,0,0,0,0,0,0,0,( ...
  -1).*Ix2.*sin(theta2),(Iy2+(-1).*Iz2).*cos(phi2).*cos(theta2).* ...
  sin(phi2),cos(theta2).^2.*(Iz2.*cos(phi2).^2+Iy2.*sin(phi2).^2)+ ...
  Ix2.*sin(theta2).^2];

fdq1 = Fxp+(dalpha1.^2+dbeta1.^2).*Lr.*mQ1.*cos(alpha1).*cos(beta1)+( ...
  dalpha2.^2+dbeta2.^2).*Lr.*mQ2.*cos(alpha2).*cos(beta2)+(-2).*Lr.* ...
  (dalpha1.*dbeta1.*mQ1.*sin(alpha1).*sin(beta1)+dalpha2.*dbeta2.* ...
  mQ2.*sin(alpha2).*sin(beta2))+Fz1.*sin(phi1).*sin(psi1)+Fz2.*sin( ...
  phi2).*sin(psi2)+Fz1.*cos(phi1).*cos(psi1).*sin(theta1)+Fz2.*cos( ...
  phi2).*cos(psi2).*sin(theta2);

fdq2 = Fyp+Lr.*((dalpha1.^2+dbeta1.^2).*mQ1.*cos(beta1).*sin(alpha1)+( ...
  dalpha2.^2+dbeta2.^2).*mQ2.*cos(beta2).*sin(alpha2)+2.*dalpha1.* ...
  dbeta1.*mQ1.*cos(alpha1).*sin(beta1)+2.*dalpha2.*dbeta2.*mQ2.*cos( ...
  alpha2).*sin(beta2))+(-1).*Fz1.*cos(psi1).*sin(phi1)+(-1).*Fz2.* ...
  cos(psi2).*sin(phi2)+Fz1.*cos(phi1).*sin(psi1).*sin(theta1)+Fz2.* ...
  cos(phi2).*sin(psi2).*sin(theta2);

fdq3 = Fzp+(-1).*g.*(mP+mQ1+mQ2)+Fz1.*cos(phi1).*cos(theta1)+Fz2.*cos( ...
  phi2).*cos(theta2)+dbeta1.^2.*Lr.*mQ1.*sin(beta1)+dbeta2.^2.*Lr.* ...
  mQ2.*sin(beta2);

fdq4 = Lr.*cos(beta1).*(2.*dalpha1.*dbeta1.*Lr.*mQ1.*sin(beta1)+(-1).* ...
  Fz1.*(cos(alpha1+(-1).*psi1).*sin(phi1)+cos(phi1).*sin(alpha1+(-1) ...
  .*psi1).*sin(theta1)));

fdq5 = (-1).*Lr.*(cos(beta1).*((-1).*Fz1.*cos(phi1).*cos(theta1)+mQ1.*(g+ ...
  dalpha1.^2.*Lr.*sin(beta1)))+Fz1.*sin(beta1).*((-1).*sin(phi1).* ...
  sin(alpha1+(-1).*psi1)+cos(phi1).*cos(alpha1+(-1).*psi1).*sin( ...
  theta1)));

fdq6 = Mx1+dpsi1.*dtheta1.*(Ix1+(Iy1+(-1).*Iz1).*cos(2.*phi1)).*cos( ...
  theta1)+(-1).*(Iy1+(-1).*Iz1).*cos(phi1).*(dtheta1.^2+(-1).* ...
  dpsi1.^2.*cos(theta1).^2).*sin(phi1);

fdq7 = cos(phi1).*(My1+2.*dphi1.*dtheta1.*(Iy1+(-1).*Iz1).*sin(phi1))+( ...
  1/4).*((-4).*Mz1.*sin(phi1)+2.*dpsi1.*(Iy1+(-1).*Iz1).*cos(2.* ...
  phi1).*cos(theta1).*((-2).*dphi1+dpsi1.*sin(theta1))+(-2).*dpsi1.* ...
  cos(theta1).*(2.*dphi1.*Ix1+dpsi1.*((-2).*Ix1+Iy1+Iz1).*sin( ...
  theta1)));

fdq8 = dphi1.*dpsi1.*((-1).*Iy1+Iz1).*cos(theta1).^2.*sin(2.*phi1)+(-1).* ...
  (Mx1+dtheta1.^2.*((-1).*Iy1+Iz1).*cos(phi1).*sin(phi1)).*sin( ...
  theta1)+cos(theta1).*(dphi1.*dtheta1.*Ix1+Mz1.*cos(phi1)+My1.*sin( ...
  phi1)+dpsi1.*dtheta1.*((-2).*Ix1+Iy1+Iz1).*sin(theta1)+(-1).* ...
  dtheta1.*(Iy1+(-1).*Iz1).*cos(2.*phi1).*(dphi1+dpsi1.*sin(theta1)) ...
  );

fdq9 = Lr.*cos(beta2).*(2.*dalpha2.*dbeta2.*Lr.*mQ2.*sin(beta2)+(-1).* ...
  Fz2.*(cos(alpha2+(-1).*psi2).*sin(phi2)+cos(phi2).*sin(alpha2+(-1) ...
  .*psi2).*sin(theta2)));

fdq10 =(-1).*Lr.*(cos(beta2).*((-1).*Fz2.*cos(phi2).*cos(theta2)+mQ2.*(g+ ...
  dalpha2.^2.*Lr.*sin(beta2)))+Fz2.*sin(beta2).*((-1).*sin(phi2).* ...
  sin(alpha2+(-1).*psi2)+cos(phi2).*cos(alpha2+(-1).*psi2).*sin( ...
  theta2)));
 

fdq11 = Mx2+dpsi2.*dtheta2.*(Ix2+(Iy2+(-1).*Iz2).*cos(2.*phi2)).*cos( ...
  theta2)+(-1).*(Iy2+(-1).*Iz2).*cos(phi2).*(dtheta2.^2+(-1).* ...
  dpsi2.^2.*cos(theta2).^2).*sin(phi2);

fdq12 = cos(phi2).*(My2+2.*dphi2.*dtheta2.*(Iy2+(-1).*Iz2).*sin(phi2))+( ...
  1/4).*((-4).*Mz2.*sin(phi2)+2.*dpsi2.*(Iy2+(-1).*Iz2).*cos(2.* ...
  phi2).*cos(theta2).*((-2).*dphi2+dpsi2.*sin(theta2))+(-2).*dpsi2.* ...
  cos(theta2).*(2.*dphi2.*Ix2+dpsi2.*((-2).*Ix2+Iy2+Iz2).*sin( ...
  theta2)));

fdq13 = dphi2.*dpsi2.*((-1).*Iy2+Iz2).*cos(theta2).^2.*sin(2.*phi2)+(-1).* ...
  (Mx2+dtheta2.^2.*((-1).*Iy2+Iz2).*cos(phi2).*sin(phi2)).*sin( ...
  theta2)+cos(theta2).*(dphi2.*dtheta2.*Ix2+Mz2.*cos(phi2)+My2.*sin( ...
  phi2)+dpsi2.*dtheta2.*((-2).*Ix2+Iy2+Iz2).*sin(theta2)+(-1).* ...
  dtheta2.*(Iy2+(-1).*Iz2).*cos(2.*phi2).*(dphi2+dpsi2.*sin(theta2)) ...
  );

fdq = [fdq1,fdq2,fdq3,fdq4,fdq5,fdq6,fdq7,fdq8,fdq9,fdq10,fdq11,fdq12,fdq13]';
dummy = M\fdq;

xpdot = dxp;
dxpdot = dummy(1);
ypdot = dyp;
dypdot = dummy(2);
zpdot = dzp;
dzpdot = dummy(3);

alpha1dot = dalpha1;
dalpha1dot = dummy(4);
beta1dot = dbeta1;
dbeta1dot = dummy(5);

phi1dot = dphi1;
dphi1dot = dummy(6);
theta1dot = dtheta1;
dtheta1dot = dummy(7);
psi1dot = dpsi1;
dpsi1dot = dummy(8);


alpha2dot = dalpha2;
dalpha2dot = dummy(9);
beta2dot = dbeta2;
dbeta2dot = dummy(10);

phi2dot = dphi2;
dphi2dot = dummy(11);
theta2dot = dtheta2;
dtheta2dot = dummy(12);
psi2dot = dpsi2;
dpsi2dot = dummy(13);


sys = [xpdot;dxpdot;ypdot;dypdot;zpdot;dzpdot;...
    alpha1dot;dalpha1dot;beta1dot;dbeta1dot;...
    phi1dot;dphi1dot;theta1dot;dtheta1dot;psi1dot;dpsi1dot;...
    alpha2dot;dalpha2dot;beta2dot;dbeta2dot;...
    phi2dot;dphi2dot;theta2dot;dtheta2dot;psi2dot;dpsi2dot;]; 
function sys=mdlOutputs(t,x,u)
%% Model states and controllors:
xp = x(1); dxp = x(2);
yp = x(3); dyp = x(4);
zp = x(5); dzp = x(6);
alpha1 = x(7); dalpha1 = x(8);
beta1 = x(9); dbeta1 = x(10);
phi1 = x(11); dphi1 = x(12);
theta1 = x(13); dtheta1 = x(14);
psi1 = x(15); dpsi1 = x(16);

alpha2 = x(17); dalpha2 = x(18);
beta2 = x(19); dbeta2 = x(20);
phi2 = x(21); dphi2 = x(22);
theta2 = x(23); dtheta2 = x(24);
psi2 = x(25); dpsi2 = x(26);

Fz1=u(1);Mx1=u(2);My1=u(3);Mz1=u(4);
Fz2=u(5);Mx2=u(6);My2=u(7);Mz2=u(8);
Fxp = u(9);
Fyp = u(10);
Fzp = u(11);
%% TransForm Matrix
sys = [xp;dxp;yp;dyp;zp;dzp;...
    alpha1;dalpha1;beta1;dbeta1;...
    phi1;dphi1;theta1;dtheta1;psi1;dpsi1;...
    alpha2;dalpha2;beta2;dbeta2;...
    phi2;dphi2;theta2;dtheta2;psi2;dpsi2;];

function sys=mdlGetTimeOfNextVarHit(t,x,u)
sampleTime = 1;    %  Example, set the next hit to be one second later.
sys = t + sampleTime;

function sys=mdlTerminate(t,x,u)
sys = [];